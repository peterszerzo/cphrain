<!DOCTYPE html>
<html>
  <head>
    <title>CphRain | Task 4</title>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Montserrat|Inconsolata" rel="stylesheet">
    <link href="demo.css" rel="stylesheet">
    <meta charset='utf-8'>
  </head>
  <body>
    <div id="app"></div>
    <div class="commentary">
      <div class="commentary__content">
        <h2>Task 4</h2>
        <p>+ add some upward drops</p>
      </div>
    </div>
    <script src="vendor/cphrain.js"></script>
    <script>
      function generateDrop(isTop) {
        const isUpward = Math.random() < .1;
        const z = Math.random() * 2 - 1;
        return {
          x: Math.random(),
          y: isTop ? (isUpward ? 1.1 : -.1) : Math.random(),
          scale: z > 0 ? (1 + z) : (1 + z / 2),
          blur: Math.floor(6 * z),
          v: (isUpward ? -1 : 1) * (0.008 + 0.004 * z)
        };
      }

      function generateInitialDrops(n) {
        const drops = [];
        for (let i = 0; i < n; i++) {
          drops.push(generateDrop(false));
        }
        return drops;
      }

      function stepDrop(drop) {
        if ((drop.v > 0 && drop.y > 1.1) || (drop.v < 0 && drop.y < -.1)) {
          return generateDrop(true);
        }
        return {
          scale: drop.scale,
          blur: drop.blur,
          x: drop.x,
          y: drop.y + drop.v,
          v: drop.v
        };
      }

      function stepDrops(drops) {
        return drops.map(stepDrop);
      }

      console.log('Hi, Mom!');
      cphRain(generateInitialDrops(30), stepDrops, document.getElementById('app'));
    </script>
  </body>
</html>
